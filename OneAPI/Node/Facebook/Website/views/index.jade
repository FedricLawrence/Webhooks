extends layout

block head
  // Facebook Send to Messenger standard code to include in the head of the page
  script(type="text/javascript").
    window.fbAsyncInit = function() {
      FB.init({
        appId: "APP_ID",
        xfbml: true,
        version: "v2.6"
      });
    };

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) { return; }
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

block content
  h1="Facebook Opt-in Page"
  p You will need to add the Facebook "Send to Messenger" web plugin to your website to get permission to send the user messages via Facebook. This would usually be on your check out page etc...
  hr
  p Click below to recieve updates via Facebook Messenger
  // The data-ref field will be populated with the metadata returned from Comapi's Facebook webservice', add your own Facebook page_id
  div(
    class="fb-send-to-messenger" 
    messenger_app_id="336037380081042" 
    page_id="***ENTER YOUR PAGE_ID HERE***" 
    data-ref="#{metadata}" 
    color="blue" 
    size="large")
  hr
  p When it is clicked a unique Facebook Messenger Id will be created for the customer and your page and automatically sent to Comapi where a <b>fbMessengerId</b> field will be added to the profile you indicated using the <b>data-ref</b> field on the Send to Messenger control